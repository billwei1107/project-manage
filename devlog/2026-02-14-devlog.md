# 2026-02-14 開發日誌 (Development Log)

## 開發規劃 (Planning)
- [x] 實作 Kanban 專案管理看板 (Kanban Board Implementation)
- [x] 後端: 新增 deadline 與 description 欄位 (Backend: Add fields)
- [x] 前台: 實作 Quick Add 與 Task Details 編輯 (Frontend: Quick Add & Task Editing)

## 進度 (Progress)
### 完成功能
- **Kanban Board Enhancement**:
    - [Task] 實作 Quick Add 功能，支援快速建立待辦事項 (類似 Apple Reminders)。
    - [Task] 實作任務詳情編輯 Modal，支援修改標題、狀態、截止日期、指派人員與備註。
    - [Backend] 擴充 Task 實體 (Entity) 與 DTO，新增 `deadline` 與 `description` 欄位。
    - [Frontend] 整合原生 Date Picker 以避免額外依賴，確保輕量化。

### 提交內容
- **Task.java**: 新增 `deadline`, `description`。
- **TaskService.java**: 更新 CRUD 邏輯。
- **ProjectKanban.tsx**: 整合 Quick Add 與 TaskDetailModal。
- **TaskDetailModal.tsx**: 新增組件。

### 部署記錄 (Deployment)
- **手動部署**: 因 CI/CD 未能自動更新程式碼 (Git ownership issue)，執行了手動部署腳本。
- **修復**: 在伺服器上執行 `git config --global --add safe.directory /root/project-manage` 解決權限問題。
- **狀態**: 服務已重新啟動 (Backend & Frontend)。

### 更新記錄 - 專案編輯與動態進度 (Project Edit & Progress)
- **後端 (Backend)**:
  - `TaskRepository`: 新增 `countByProjectId` 與 `countByProjectIdAndStatus` 方法。
  - `ProjectService`: 在 `mapToResponse` 中動態計算專案進度 (`progress`)。
- **前端 (Frontend)**:
  - `AddProjectModal`: 支援 `project` 屬性以進行編輯。
  - `ProjectList`: 新增編輯功能，點擊選單中的「編輯」即可修改專案資訊。
- **部署 (Deployment)**:
  - 再次執行手動部署腳本，更新伺服器程式碼並重啟服務。

### 部署修正 (Deployment Fix)
- **問題**: 用戶回報更新未生效，檢查發現本地代碼未 Push 至遠端，且伺服器上有殘留的 Port 佔用導致啟動失敗。
- **修復**:
  1. 執行 `git push origin main` 同步代碼。
  2. 更新部署腳本，加入 `docker stop $(docker ps -q)` 強制釋放 Port。
  3. 執行 `docker system prune` 清理緩存。
  4. 重新部署成功。

### 更新記錄 - 登入狀態保持 (Authentication Persistence)
- **問題**: 刷新頁面會導致登出，且未登入用戶可訪問受保護頁面。
- **修復 (Frontend)**:
  - **`useAuthStore`**: 新增 `checkAuth` 方法，從後端 `/api/v1/auth/me` 驗證 Token 並獲取用戶資訊。
  - **`RequireAuth`**: 建立路由保護組件，未登入者強制導向 `/login`。
  - **`App.tsx`**: 應用程式啟動時自動檢查登入狀態，並將 `/admin` 與 `/client` 路由納入保護。
  - **`App.tsx`**: 應用程式啟動時自動檢查登入狀態，並將 `/admin` 與 `/client` 路由納入保護。
- **部署**: 更新部署腳本以強制移除舊容器 (`docker rm`)，解決名稱衝突問題。

### 部署修正 - 強制重啟容器 (Force Restart Containers)
- **問題**: 用戶回報更新仍未生效。檢查發現容器運行時間 (`Uptime`) 為 9 小時，表示之前的部署腳本未能正確重建或重啟容器，導致舊程式碼持續運行。
- **原因**: `docker compose up --build` 可能因緩存或配置未變動而跳過重建，且未強制停止舊容器。
- **修復**:
  1. 創建 `restart_containers.exp` 腳本。
  2. 執行 `docker compose down` 完全停止並移除容器。
  3. 執行 `docker compose up -d --build --force-recreate` 強制重建並啟動。
  4. 驗證: `docker ps` 顯示容器 Uptime 為 < 1 分鐘，後端日誌顯示 Spring Boot 正在啟動 v0.0.1-SNAPSHOT。

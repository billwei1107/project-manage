---
description: Deploy latest master branch to Test Server (43.103.3.57)
---

This workflow automates the deployment process to the test server. It updates the code and rebuilds the backend container.

1.  **Check Local Git Status & Push**
    Ensure local changes, especially the daily devlog, are committed and pushed to remote before deployment.
    - If there are uncommitted changes:
      1. Update the daily devlog (`devlog/YYYY-MM-DD-devlog.md`) with the latest progress.
      2. Commit all changes: `git add . && git commit -m "feat: prepare for deployment and update devlog"` (or appropriate message).
      3. Push to remote: `git push`.
    - Else:
      1. Ensure local is synced: `git pull && git push`.

2.  **Deploy to Test Server & Pull Latest Code**
    Connect via SSH, pull latest code using `reset --hard` to avoid conflicts, and rebuild services.
    // turbo
    sshpass -p 'Ben01270127-' ssh -o StrictHostKeyChecking=no root@43.103.3.57 "cd /opt/project/case-chuangsheng-moving-erp && git fetch --all && git reset --hard origin/master && docker-compose -f docker/server/docker-compose.yml up -d --build --force-recreate --no-deps backend frontend-web"

3.  **Check Health Status**
    Verify that both backend and frontend-web containers show a `(healthy)` status.
    // turbo
    sshpass -p 'Ben01270127-' ssh -o StrictHostKeyChecking=no root@43.103.3.57 "docker ps --filter 'name=chuangsheng' --format 'table {{.Names}}\t{{.Status}}'"

4.  **Record Deployment in Daily Devlog**
    After successful deployment, record the following in the local `devlog/YYYY-MM-DD-devlog.md`:
    - **部署狀態**: 成功 / 失敗
    - **部署時間**: YYYY-MM-DD HH:MM
    - **部署 Hash**: 最新 Git 提交的 Short Hash
    - **驗證狀態**: 所有服務均已進入 `(healthy)` 狀態

5.  **Final Version Control Sync**
    Commit the updated devlog with the deployment record and push back to remote.
    - `git add devlog/YYYY-MM-DD-devlog.md`
    - `git commit -m "chore(deploy): record test server deployment status"`
    - `git push`
